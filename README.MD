# ğŸº Assistente de Reabastecimento Inteligente BEES

> **Agente IA conversacional para otimizaÃ§Ã£o de pedidos e descoberta de novos fornecedores no mercado B2B de bebidas**

[![Status](https://img.shields.io/badge/Status-Planning%20Complete-green)]()
[![Version](https://img.shields.io/badge/Version-3.0-blue)]()
[![Python](https://img.shields.io/badge/Python-3.10+-yellow)]()
[![Framework](https://img.shields.io/badge/Framework-LangChain-orange)]()
[![LLM](https://img.shields.io/badge/LLM-Gemini%201.5%20Flash-red)]()

---

## ğŸ¯ Sobre o Projeto

Este projeto implementa um **agente IA inteligente** que auxilia clientes B2B da plataforma BEES a:
1. ğŸ” **Consultar seu histÃ³rico** de compras e preferÃªncias
2. ğŸ’¡ **Descobrir novos fornecedores** locais alinhados ao seu perfil
3. ğŸ“Š **Otimizar custos** atravÃ©s de cache inteligente e perguntas condicionais

### CaracterÃ­sticas Principais

âœ… **Arquitetura Plan-and-Execute** com 3 ferramentas especializadas  
âœ… **Text-to-SQL** para consultas ao banco de dados proprietÃ¡rio  
âœ… **Cache TTL (30 dias)** para otimizaÃ§Ã£o de custos de busca web  
âœ… **OtimizaÃ§Ã£o de custo** atravÃ©s de pergunta condicional (timeout 30s)  
âœ… **CLI Conversacional** com interface Rich para demonstraÃ§Ã£o  
âœ… **API REST** (FastAPI) para integraÃ§Ã£o com sistemas externos  
âœ… **Observabilidade completa** com logs estruturados e Chain-of-Thought  

---

## ğŸš€ Quick Start

### 1. Clone e Setup

```bash
# Clone o repositÃ³rio
git clone <repository-url>
cd BESS-TecnicalCase

# Crie ambiente virtual
python -m venv venv
source venv/bin/activate  # Linux/Mac
# ou
venv\Scripts\activate     # Windows

# Instale dependÃªncias
pip install -r requirements.txt

# Configure variÃ¡veis de ambiente
cp .env.example .env
# Edite .env e adicione sua GOOGLE_API_KEY
```

### 2. Execute o CLI Conversacional

```bash
# Modo interativo (padrÃ£o)
python main.py

# Com client_id prÃ©-definido
python main.py --client_id C001

# Modo debug
python main.py --debug
```

### 3. Execute a API REST

```bash
# Desenvolvimento (com auto-reload)
uvicorn api.main:app --reload

# Acesse a documentaÃ§Ã£o
open http://localhost:8000/docs
```

---

## ğŸ“š DocumentaÃ§Ã£o

### ğŸ“– Comece Aqui
- **[INDICE.MD](INDICE.MD)** - Ãndice geral de toda a documentaÃ§Ã£o
- **[SUMARIO_EXECUTIVO.MD](SUMARIO_EXECUTIVO.MD)** - Resumo executivo (5 min)

### ğŸ—ï¸ Arquitetura e Planejamento
- **[PLANNING.MD](PLANNING.MD)** - Guia tÃ©cnico completo (7 fases)
- **[ARQUITETURA.MD](ARQUITETURA.MD)** - Diagramas e fluxos detalhados
- **[DECISOES_TECNICAS.MD](DECISOES_TECNICAS.MD)** - Stack e decisÃµes consolidadas

### ğŸ’» ImplementaÃ§Ã£o
- **[TODO.MD](TODO.MD)** - Roadmap e checklist de implementaÃ§Ã£o
- **[ESPECIFICACOES_CLI_API.MD](ESPECIFICACOES_CLI_API.MD)** - Specs completas do CLI e API

### ğŸ¤– Prompts dos Agentes
- **[prompts/planner.MD](prompts/planner.MD)** - Agente orquestrador
- **[prompts/sql_runner.MD](prompts/sql_runner.MD)** - Tool 1 (Text-to-SQL)
- **[prompts/new_opportunities.MD](prompts/new_opportunities.MD)** - Tool 2 (API Integration)
- **[prompts/web_explorer.MD](prompts/web_explorer.MD)** - Tool 3 (Cache TTL)

---

## ğŸ—ï¸ Arquitetura

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USUÃRIO (Cliente B2B)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  CLI (Rich)    â”‚    â”‚  API (FastAPI)â”‚
        â”‚  main.py       â”‚    â”‚  6 endpoints  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                     â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   PLANNER AGENT     â”‚
                â”‚  (Gemini 1.5 Flash) â”‚
                â”‚  5 Passos           â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”»â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”“
        â–¼           â–¼              â–¼           â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Tool 1 â”‚  â”‚ Tool 2 â”‚    â”‚ Tool 3 â”‚  â”‚ Logger â”‚
   â”‚  SQL   â”‚  â”‚Brewery â”‚    â”‚  Web   â”‚  â”‚  JSON  â”‚
   â”‚ Runner â”‚  â”‚ Finder â”‚    â”‚Explorerâ”‚  â”‚        â”‚
   â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚           â”‚              â”‚
       â–¼           â–¼              â–¼
   customers.db  OpenBrewery   FAISS
                   DB API       Cache
```

---

## ğŸ› ï¸ Stack TecnolÃ³gico

| Categoria | Tecnologia |
|:----------|:-----------|
| **LLM** | Google Gemini 1.5 Flash |
| **Framework** | LangChain |
| **Embeddings** | Google `models/embedding-001` |
| **Vector DB** | FAISS (local) |
| **Database** | SQLite (`customers.db`) |
| **Web Search** | Google Search API |
| **CLI** | Rich + asyncio |
| **API** | FastAPI + Uvicorn |
| **Session** | In-memory (ou Redis) |

---

## ğŸ¨ Exemplos de Uso

### CLI - Exemplo Completo

```
$ python main.py --client_id C001

ğŸº Assistente de Reabastecimento BEES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… SessÃ£o iniciada para cliente: Bar do JoÃ£o (C001)

ğŸ‘¤ VocÃª: Sugira uma nova cervejaria local

ğŸ¤” Pensando... (Buscando perfil)
ğŸ¤” Pensando... (Buscando oportunidades)

ğŸ“‹ Assistente BEES:
Suas 5 cervejas mais pedidas sÃ£o:
1. Stone IPA
2. Ballast Point Sculpin
3. Lagunitas IPA
4. Sierra Nevada Pale Ale
5. Anchor Steam

ğŸ’¡ SugestÃ£o: Modern Times Beer (micro)
Ã‰ uma cervejaria local em San Diego.

â±ï¸ Gostaria de ver um resumo detalhado? (30s)

ğŸ‘¤ VocÃª: sim

âœ… Modern Times Beer Ã© uma cervejaria artesanal
   fundada em 2013, conhecida por suas IPAs
   experimentais e ambiente descontraÃ­do.

ğŸ‘¤ VocÃª: /metrics

ğŸ“Š MÃ©tricas da SessÃ£o
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ Tempo total: 8.4s
â€¢ Cache hit rate: 100%
â€¢ Custo estimado: $0.0042
```

### API - Exemplo Python

```python
import requests

BASE_URL = "http://localhost:8000"
headers = {"X-API-Key": "your-api-key"}

# Criar sessÃ£o
session = requests.post(f"{BASE_URL}/chat/session", headers=headers)
session_id = session.json()["session_id"]

# Enviar mensagem
response = requests.post(
    f"{BASE_URL}/chat/message",
    json={
        "session_id": session_id,
        "client_id": "C001",
        "message": "Sugira uma nova cervejaria local"
    },
    headers=headers
)

print(response.json()["response"])
```

---

## ğŸ“‹ Comandos CLI

| Comando | DescriÃ§Ã£o |
|:--------|:----------|
| `/exit` ou `/quit` | Encerra o chat |
| `/clear` | Limpa histÃ³rico da conversa |
| `/log` | Mostra Chain-of-Thought da Ãºltima execuÃ§Ã£o |
| `/metrics` | Exibe mÃ©tricas da sessÃ£o |
| `/help` | Lista todos os comandos |

---

## ğŸŒ Endpoints da API

| MÃ©todo | Endpoint | DescriÃ§Ã£o |
|:-------|:---------|:----------|
| POST | `/chat/session` | Criar nova sessÃ£o |
| POST | `/chat/message` | Enviar mensagem ao agente |
| GET | `/chat/session/{id}` | Obter histÃ³rico da sessÃ£o |
| DELETE | `/chat/session/{id}` | Encerrar sessÃ£o |
| GET | `/health` | Health check |
| GET | `/metrics` | MÃ©tricas agregadas |

**DocumentaÃ§Ã£o completa:** `http://localhost:8000/docs`

---

## ğŸ§ª Testes

```bash
# Testes unitÃ¡rios
pytest tests/test_tools.py

# Testes do agente
pytest tests/test_agent.py

# Testes da API
pytest tests/test_api.py

# Todos os testes
pytest
```

---

## ğŸ“Š Estrutura do Projeto

```
BESS-TecnicalCase/
â”œâ”€â”€ ğŸ“„ DocumentaÃ§Ã£o (13 arquivos)
â”‚   â”œâ”€â”€ README.MD â† VocÃª estÃ¡ aqui
â”‚   â”œâ”€â”€ INDICE.MD
â”‚   â”œâ”€â”€ SUMARIO_EXECUTIVO.MD
â”‚   â”œâ”€â”€ PLANNING.MD
â”‚   â”œâ”€â”€ TODO.MD
â”‚   â”œâ”€â”€ DECISOES_TECNICAS.MD
â”‚   â”œâ”€â”€ ARQUITETURA.MD
â”‚   â”œâ”€â”€ ESPECIFICACOES_CLI_API.MD
â”‚   â”œâ”€â”€ RESUMO_ATUALIZACAO.MD
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â”œâ”€â”€ .env.example
â”‚   â””â”€â”€ prompts/ (4 arquivos)
â”‚
â”œâ”€â”€ ğŸ’» CÃ³digo
â”‚   â”œâ”€â”€ main.py              # CLI Conversacional
â”‚   â”œâ”€â”€ tools/               # 3 Tools especializadas
â”‚   â”œâ”€â”€ agents/              # Planner Agent
â”‚   â”œâ”€â”€ utils/               # Logger, RAG, ChatSession
â”‚   â”œâ”€â”€ api/                 # FastAPI (6 endpoints)
â”‚   â””â”€â”€ tests/               # Testes unitÃ¡rios
â”‚
â””â”€â”€ ğŸ—„ï¸ Dados
    â”œâ”€â”€ customers.db         # Banco SQLite
    â”œâ”€â”€ data/faiss_index/    # Cache RAG
    â””â”€â”€ logs/                # Logs de execuÃ§Ã£o
```

---

## ğŸ¯ Roadmap

### âœ… Fase 1: Planejamento (Completo)
- [x] Arquitetura definida
- [x] DocumentaÃ§Ã£o completa
- [x] Prompts dos agentes
- [x] EspecificaÃ§Ãµes CLI e API

### â³ Fase 2: ImplementaÃ§Ã£o Core (PrÃ³ximo)
- [ ] Setup inicial
- [ ] ImplementaÃ§Ã£o das 3 Tools
- [ ] Agente Orquestrador
- [ ] Sistema de Logging

### â³ Fase 3: Interfaces
- [ ] CLI Conversacional (main.py)
- [ ] API REST (FastAPI)

### â³ Fase 4: Testes e Deploy
- [ ] Testes unitÃ¡rios
- [ ] Testes E2E
- [ ] Collection Postman
- [ ] DocumentaÃ§Ã£o de uso final

---

## ğŸ¤ Contribuindo

Este Ã© um projeto de demonstraÃ§Ã£o tÃ©cnica para a BEES. Para contribuir:

1. Leia a documentaÃ§Ã£o completa em [INDICE.MD](INDICE.MD)
2. Siga o roadmap em [TODO.MD](TODO.MD)
3. Consulte as especificaÃ§Ãµes em [ESPECIFICACOES_CLI_API.MD](ESPECIFICACOES_CLI_API.MD)

---

## ğŸ“ LicenÃ§a

Este projeto Ã© proprietÃ¡rio e confidencial da BEES.

---

## ğŸ“ Contato

**ResponsÃ¡vel:** Anderson  
**Projeto:** BEES Technical Case  
**VersÃ£o:** 3.0 Final  
**Data:** 15/11/2025

---

## ğŸŒŸ Destaques TÃ©cnicos

### OtimizaÃ§Ãµes Implementadas

ğŸš€ **Cache TTL (30 dias)** - Reduz custos de busca web em ~70-80%  
ğŸš€ **Pergunta Condicional** - Reduz chamadas desnecessÃ¡rias em ~50%  
ğŸš€ **Schema Injection** - Elimina RAG adicional, mais simples e rÃ¡pido  
ğŸš€ **Filtro de HistÃ³rico** - Garante apenas novidades para o cliente  

### Observabilidade

ğŸ“Š **Logs Estruturados** - JSON com timestamp, args, results  
ğŸ“Š **Chain-of-Thought** - Trace completo de execuÃ§Ã£o  
ğŸ“Š **MÃ©tricas em Tempo Real** - Tempo, cache hit rate, custo estimado  
ğŸ“Š **Health Check** - Status de todos os serviÃ§os  

---

**Status Atual:** âœ… Planejamento 100% Completo | â³ Pronto para ImplementaÃ§Ã£o

**PrÃ³ximo Passo:** Execute `python main.py` apÃ³s implementar o cÃ³digo ğŸš€
